/*! For license information please see filepond-plugin-image-exif-orientation.esm.3fb6c78b.js.LICENSE.txt */
const isJPEG=A=>/^image\/jpeg/.test(A.type),Marker={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280},getUint16=(A,e,t=!1)=>A.getUint16(e,t),getUint32=(A,e,t=!1)=>A.getUint32(e,t),getImageOrientation=A=>new Promise(((e,t)=>{const n=new FileReader;n.onload=function(A){const t=new DataView(A.target.result);if(getUint16(t,0)!==Marker.JPEG)return void e(-1);const n=t.byteLength;let i=2;for(;i<n;){const A=getUint16(t,i);if(i+=2,A===Marker.APP1){if(getUint32(t,i+=2)!==Marker.EXIF)break;const A=getUint16(t,i+=6)===Marker.TIFF;i+=getUint32(t,i+4,A);const n=getUint16(t,i,A);i+=2;for(let r=0;r<n;r++)if(getUint16(t,i+12*r,A)===Marker.Orientation)return void e(getUint16(t,i+12*r+8,A))}else{if((A&Marker.Unknown)!==Marker.Unknown)break;i+=getUint16(t,i)}}e(-1)},n.readAsArrayBuffer(A.slice(0,65536))})),IS_BROWSER="undefined"!=typeof window&&void 0!==window.document,isBrowser=()=>IS_BROWSER,testSrc="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=";let shouldCorrect;const testImage=isBrowser()?new Image:{};testImage.onload=()=>shouldCorrect=testImage.naturalWidth>testImage.naturalHeight,testImage.src=testSrc;const shouldCorrectImageExifOrientation=()=>shouldCorrect,plugin=({addFilter:A,utils:e})=>{const{Type:t,isFile:n}=e;return A("DID_LOAD_ITEM",((A,{query:e})=>new Promise(((t,i)=>{const r=A.file;if(!(n(r)&&isJPEG(r)&&e("GET_ALLOW_IMAGE_EXIF_ORIENTATION")&&shouldCorrectImageExifOrientation()))return t(A);getImageOrientation(r).then((e=>{A.setMetadata("exif",{orientation:e}),t(A)}))})))),{options:{allowImageExifOrientation:[!0,t.BOOLEAN]}}},isBrowser$1="undefined"!=typeof window&&void 0!==window.document;isBrowser$1&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin}));export default plugin;