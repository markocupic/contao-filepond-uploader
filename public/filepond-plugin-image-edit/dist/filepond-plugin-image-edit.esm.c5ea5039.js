/*! For license information please see filepond-plugin-image-edit.esm.c5ea5039.js.LICENSE.txt */
const isPreviewableImage=e=>/^image/.test(e.type),plugin=e=>{const{addFilter:t,utils:i,views:o}=e,{Type:n,createRoute:r,createItemAPI:l=e=>e}=i,{fileActionButton:a}=o;t("SHOULD_REMOVE_ON_REVERT",((e,{item:t,query:i})=>new Promise((e=>{const{file:o}=t;e(!(i("GET_ALLOW_IMAGE_EDIT")&&i("GET_IMAGE_EDIT_ALLOW_EDIT")&&isPreviewableImage(o)))})))),t("DID_LOAD_ITEM",((e,{query:t,dispatch:i})=>new Promise(((o,n)=>{if(e.origin>1)return void o(e);const{file:r}=e;if(!t("GET_ALLOW_IMAGE_EDIT")||!t("GET_IMAGE_EDIT_INSTANT_EDIT"))return void o(e);if(!isPreviewableImage(r))return void o(e);const l=(e,t,o)=>n=>{d.shift(),n?t(e):o(e),i("KICK"),a()},a=()=>{if(!d.length)return;const{item:e,resolve:t,reject:o}=d[0];i("EDIT_ITEM",{id:e.id,handleEditorResponse:l(e,t,o)})};E({item:e,resolve:o,reject:n}),1===d.length&&a()})))),t("DID_CREATE_ITEM",((e,{query:t,dispatch:i})=>{e.extend("edit",(()=>{i("EDIT_ITEM",{id:e.id})}))}));const d=[],E=e=>(d.push(e),e);return t("CREATE_VIEW",(e=>{const{is:t,view:i,query:o}=e;if(!o("GET_ALLOW_IMAGE_EDIT"))return;const n=o("GET_ALLOW_IMAGE_PREVIEW");if(!(t("file-info")&&!n||t("file")&&n))return;const d=o("GET_IMAGE_EDIT_EDITOR");if(!d)return;d.filepondCallbackBridge||(d.outputData=!0,d.outputFile=!1,d.filepondCallbackBridge={onconfirm:d.onconfirm||(()=>{}),oncancel:d.oncancel||(()=>{})});i.registerDestroyer((({root:e})=>{e.ref.buttonEditItem&&e.ref.buttonEditItem.off("click",e.ref.handleEdit),e.ref.editButton&&e.ref.editButton.removeEventListener("click",e.ref.handleEdit)}));const E={EDIT_ITEM:({root:e,props:t,action:i})=>{const{id:o}=t,{handleEditorResponse:n}=i;d.cropAspectRatio=e.query("GET_IMAGE_CROP_ASPECT_RATIO")||d.cropAspectRatio,d.outputCanvasBackgroundColor=e.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||d.outputCanvasBackgroundColor;const r=e.query("GET_ITEM",o);if(!r)return;const a=r.file,E=r.getMetadata("crop"),s=r.getMetadata("resize"),c=r.getMetadata("filter")||null,I=r.getMetadata("filters")||null,u=r.getMetadata("colors")||null,_=r.getMetadata("markup")||null,T={crop:E||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},size:s?{upscale:s.upscale,mode:s.mode,width:s.size.width,height:s.size.height}:null,filter:I?I.id||I.matrix:e.query("GET_ALLOW_IMAGE_FILTER")&&e.query("GET_IMAGE_FILTER_COLOR_MATRIX")&&!u?c:null,color:u,markup:_};d.onconfirm=({data:e})=>{const{crop:t,size:i,filter:o,color:a,colorMatrix:E,markup:s}=e,c={};if(t&&(c.crop=t),i){const e=(r.getMetadata("resize")||{}).size,t={width:i.width,height:i.height};t.width&&t.height||!e||(t.width=e.width,t.height=e.height),(t.width||t.height)&&(c.resize={upscale:i.upscale,mode:i.mode,size:t})}s&&(c.markup=s),c.colors=a,c.filters=o,c.filter=E,r.setMetadata(c),d.filepondCallbackBridge.onconfirm(e,l(r)),n&&(d.onclose=()=>{n(!0),d.onclose=null})},d.oncancel=()=>{d.filepondCallbackBridge.oncancel(l(r)),n&&(d.onclose=()=>{n(!1),d.onclose=null})},d.open(a,T)},DID_LOAD_ITEM:({root:e,props:t})=>{if(!o("GET_IMAGE_EDIT_ALLOW_EDIT"))return;const{id:r}=t,l=o("GET_ITEM",r);if(!l)return;const d=l.file;if(isPreviewableImage(d))if(e.ref.handleEdit=t=>{t.stopPropagation(),e.dispatch("EDIT_ITEM",{id:r})},n){const t=i.createChildView(a,{label:"edit",icon:o("GET_IMAGE_EDIT_ICON_EDIT"),opacity:0});t.element.classList.add("filepond--action-edit-item"),t.element.dataset.align=o("GET_STYLE_IMAGE_EDIT_BUTTON_EDIT_ITEM_POSITION"),t.on("click",e.ref.handleEdit),e.ref.buttonEditItem=i.appendChildView(t)}else{const t=i.element.querySelector(".filepond--file-info-main"),n=document.createElement("button");n.className="filepond--action-edit-item-alt",n.innerHTML=o("GET_IMAGE_EDIT_ICON_EDIT")+"<span>edit</span>",n.addEventListener("click",e.ref.handleEdit),t.appendChild(n),e.ref.editButton=n}}};if(n){const e=({root:e})=>{e.ref.buttonEditItem&&(e.ref.buttonEditItem.opacity=1)};E.DID_IMAGE_PREVIEW_SHOW=e}i.registerWriter(r(E))})),{options:{allowImageEdit:[!0,n.BOOLEAN],styleImageEditButtonEditItemPosition:["bottom center",n.STRING],imageEditInstantEdit:[!1,n.BOOLEAN],imageEditAllowEdit:[!0,n.BOOLEAN],imageEditIconEdit:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M8.5 17h1.586l7-7L15.5 8.414l-7 7V17zm-1.707-2.707l8-8a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-8 8A1 1 0 0 1 10.5 19h-3a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707z" fill="currentColor" fill-rule="nonzero"/></svg>',n.STRING],imageEditEditor:[null,n.OBJECT]}}},isBrowser="undefined"!=typeof window&&void 0!==window.document;isBrowser&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin}));export default plugin;