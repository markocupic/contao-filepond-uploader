class ContaoFilepondPlugin{#t=!1;#i=null;#e={};#s=[FilePondPluginImagePreview,FilePondPluginImageExifOrientation,FilePondPluginFileValidateSize,FilePondPluginImageEdit,FilePondPluginFileValidateType,FilePondPluginImageValidateSize];constructor(t,i,e,s){this.widget=t,this.name=i,this.jsConfig=e,this.#i=s,this.#n()}#n(){this.setAllowedExtensions(this.jsConfig.extensions),this.jsConfig.multiple?1===this.jsConfig.limit?(this.setAttribute("data-max-files",1),this.setAttribute("name",this.name),this.#t=!1):this.jsConfig.limit>1?(this.setAttribute("multiple",""),this.setAttribute("data-max-files",this.jsConfig.limit),this.setAttribute("name",this.name+"[]"),this.#t=!0):(this.setAttribute("multiple",""),this.setAttribute("name",this.name+"[]"),this.#t=!0):(this.setAttribute("data-max-files",1),this.setAttribute("name",this.name),this.#t=!1),this.jsConfig.minSizeLimit&&this.setAttribute("data-min-file-size",this.jsConfig.minSizeLimit),this.jsConfig.maxSizeLimit&&this.setAttribute("data-max-file-size",this.jsConfig.maxSizeLimit),this.setPlugins(this.#s),this.#o()}getAttribute(t){return this.widget.getAttribute(t)}setAttribute(t,i){return this.widget.setAttribute(t,i),this}removeAttribute(t){return this.widget.removeAttribute(t),this}setAllowedExtensions(t){return this.widget.setAttribute("accept",t),this}setPlugins(t){return this.#s=t,this.#i.registerPlugin(...this.#s),this}getPond(){return this.#i}getOptions(){return this.#e}setOptions(t){return this.#e=t,this}run(){this.#i.create(this.widget,this.#e)}#o(){this.#e={...this.jsConfig.translations,maxParallelUploads:this.jsConfig.maxConnections,instantUpload:!0,allowMultiple:this.#t,allowFileTypeValidation:!0,onaddfile:(t,i)=>{i.setMetadata("itemId",i.id)},server:{process:(t,i,e,s,n,o,a,l,r)=>{const h=e.itemId,d=document.querySelectorAll("#filepond--item-"+h+" .filepond--contao-error");for(const t of d)t.remove();const g=new FormData;g.append(t,i,i.name),g.append("REQUEST_TOKEN",this.jsConfig.csrfToken),g.append("action","filepond_upload");const m=new XMLHttpRequest;return m.open("POST",window.location.href),m.setRequestHeader("Accept","application/json"),m.setRequestHeader("name",this.name),m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.setRequestHeader("filePondItemId",h),m.upload.onprogress=t=>{o(t.lengthComputable,t.loaded,t.total)},m.onload=function(){if(m.status>=200&&m.status<300){const t=JSON.parse(m.response);!0===t.success?s(t.transferKey):t.error?n(t.error):n("There has been an error!")}else n("There has been an error!")},m.send(g),{abort:()=>{m.abort(),a()}}},fetch:null,revert:null},fileValidateTypeDetectType:(t,i)=>new Promise(((i,e)=>{i(`.${t.name.split(".").pop().toLowerCase()}`)}))},this.#e.allowImageValidateSize=!0,this.jsConfig.maxImageWidth&&(this.#e.imageValidateSizeMaxWidth=this.jsConfig.maxImageWidth),this.jsConfig.maxImageHeight&&(this.#e.imageValidateSizeMaxHeight=this.jsConfig.maxImageHeight),this.#e.allowFileSizeValidation=!0,this.jsConfig.minSizeLimit&&(this.#e.minFileSize=this.jsConfig.minSizeLimit),this.jsConfig.maxSizeLimit&&(this.#e.maxFileSize=this.jsConfig.maxSizeLimit),this.jsConfig.allowImageResize&&(this.#i.registerPlugin(FilePondPluginImageResize,FilePondPluginImageTransform),this.#e.allowImageResize=!0,this.#e.imageResizeTargetWidth=this.jsConfig.imageResizeTargetWidth,this.#e.imageResizeTargetHeight=this.jsConfig.imageResizeTargetHeight,this.#e.imageResizeMode=this.jsConfig.imageResizeMode,this.#e.imageResizeUpscale=this.jsConfig.imageResizeUpscale),document.addEventListener("FilePond:processfile",(t=>{if(void 0!==t.detail.error.body&&""!==t.detail.error.body){const i=t.detail.error.body,e=t.detail.file.id,s=document.querySelector("#filepond--item-"+e+" .filepond--file-status-main");if(s){const t=document.createElement("span");t.setAttribute("class","filepond--contao-error"),t.setAttribute("style","font-size: 0.75rem"),t.innerText=i,s.parentNode.insertBefore(t,s.nextSibling)}}}))}}