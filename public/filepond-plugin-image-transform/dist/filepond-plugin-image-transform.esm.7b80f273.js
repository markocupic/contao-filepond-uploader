/*! For license information please see filepond-plugin-image-transform.esm.7b80f273.js.LICENSE.txt */
const isImage=t=>/^image/.test(t.type),getFilenameWithoutExtension=t=>t.substr(0,t.lastIndexOf("."))||t,ExtensionMap={jpeg:"jpg","svg+xml":"svg"},renameFileToMatchMimeType=(t,e)=>{const a=getFilenameWithoutExtension(t),i=e.split("/")[1];return`${a}.${ExtensionMap[i]||i}`},getValidOutputMimeType=t=>/jpeg|png|svg\+xml/.test(t)?t:"image/jpeg",isImage$1=t=>/^image/.test(t.type),MATRICES={1:()=>[1,0,0,1,0,0],2:t=>[-1,0,0,1,t,0],3:(t,e)=>[-1,0,0,-1,t,e],4:(t,e)=>[1,0,0,-1,0,e],5:()=>[0,1,1,0,0,0],6:(t,e)=>[0,1,-1,0,e,0],7:(t,e)=>[0,-1,-1,0,e,t],8:t=>[0,-1,1,0,0,t]},getImageOrientationMatrix=(t,e,a)=>(-1===a&&(a=1),MATRICES[a](t,e)),createVector=(t,e)=>({x:t,y:e}),vectorDot=(t,e)=>t.x*e.x+t.y*e.y,vectorSubtract=(t,e)=>createVector(t.x-e.x,t.y-e.y),vectorDistanceSquared=(t,e)=>vectorDot(vectorSubtract(t,e),vectorSubtract(t,e)),vectorDistance=(t,e)=>Math.sqrt(vectorDistanceSquared(t,e)),getOffsetPointOnEdge=(t,e)=>{const a=t,i=e,r=1.5707963267948966-e,n=Math.sin(1.5707963267948966),o=Math.sin(i),s=Math.sin(r),l=Math.cos(r),c=a/n;return createVector(l*(c*o),l*(c*s))},getRotatedRectSize=(t,e)=>{const a=t.width,i=t.height,r=getOffsetPointOnEdge(a,e),n=getOffsetPointOnEdge(i,e),o=createVector(t.x+Math.abs(r.x),t.y-Math.abs(r.y)),s=createVector(t.x+t.width+Math.abs(n.y),t.y+Math.abs(n.x)),l=createVector(t.x-Math.abs(n.y),t.y+t.height-Math.abs(n.x));return{width:vectorDistance(o,s),height:vectorDistance(o,l)}},getImageRectZoomFactor=(t,e,a=0,i={x:.5,y:.5})=>{const r=i.x>.5?1-i.x:i.x,n=i.y>.5?1-i.y:i.y,o=2*r*t.width,s=2*n*t.height,l=getRotatedRectSize(e,a);return Math.max(l.width/o,l.height/s)},getCenteredCropRect=(t,e)=>{let a=t.width,i=a*e;i>t.height&&(i=t.height,a=i/e);return{x:.5*(t.width-a),y:.5*(t.height-i),width:a,height:i}},calculateCanvasSize=(t,e,a=1)=>{const i=t.height/t.width;let r=e,n=1,o=i;o>r&&(o=r,n=o/i);const s=Math.max(1/n,r/o),l=t.width/(a*s*n);return{width:l,height:l*e}},canvasRelease=t=>{t.width=1,t.height=1;t.getContext("2d").clearRect(0,0,1,1)},isFlipped=t=>t&&(t.horizontal||t.vertical),getBitmap=(t,e,a)=>{if(e<=1&&!isFlipped(a))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;const i=document.createElement("canvas"),r=t.naturalWidth,n=t.naturalHeight,o=e>=5&&e<=8;o?(i.width=n,i.height=r):(i.width=r,i.height=n);const s=i.getContext("2d");if(e&&s.transform.apply(s,getImageOrientationMatrix(r,n,e)),isFlipped(a)){const t=[1,0,0,1,0,0];(!o&&a.horizontal||o&a.vertical)&&(t[0]=-1,t[4]=r),(!o&&a.vertical||o&&a.horizontal)&&(t[3]=-1,t[5]=n),s.transform(...t)}return s.drawImage(t,0,0,r,n),i},imageToImageData=(t,e,a={},i={})=>{const{canvasMemoryLimit:r,background:n=null}=i,o=a.zoom||1,s=getBitmap(t,e,a.flip),l={width:s.width,height:s.height},c=a.aspectRatio||l.height/l.width;let h=calculateCanvasSize(l,c,o);if(r){const t=h.width*h.height;if(t>r){const e=Math.sqrt(r)/Math.sqrt(t);l.width=Math.floor(l.width*e),l.height=Math.floor(l.height*e),h=calculateCanvasSize(l,c,o)}}const d=document.createElement("canvas"),u={x:.5*h.width,y:.5*h.height},g={x:0,y:0,width:h.width,height:h.height,center:u},p=void 0===a.scaleToFit||a.scaleToFit,m=o*getImageRectZoomFactor(l,getCenteredCropRect(g,c),a.rotation,p?a.center:{x:.5,y:.5});d.width=Math.round(h.width/m),d.height=Math.round(h.height/m),u.x/=m,u.y/=m;const y=u.x-l.width*(a.center?a.center.x:.5),f=u.y-l.height*(a.center?a.center.y:.5),M=d.getContext("2d");n&&(M.fillStyle=n,M.fillRect(0,0,d.width,d.height)),M.translate(u.x,u.y),M.rotate(a.rotation||0),M.drawImage(s,y-u.x,f-u.y,l.width,l.height);const w=M.getImageData(0,0,d.width,d.height);return canvasRelease(d),w},IS_BROWSER="undefined"!=typeof window&&void 0!==window.document;IS_BROWSER&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,a){var i=this.toDataURL(e,a).split(",")[1];setTimeout((function(){for(var a=atob(i),r=a.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=a.charCodeAt(o);t(new Blob([n],{type:e||"image/png"}))}))}}));const canvasToBlob=(t,e,a=null)=>new Promise((i=>{const r=a?a(t):t;Promise.resolve(r).then((t=>{t.toBlob(i,e.type,e.quality)}))})),vectorMultiply=(t,e)=>createVector$1(t.x*e,t.y*e),vectorAdd=(t,e)=>createVector$1(t.x+e.x,t.y+e.y),vectorNormalize=t=>{const e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:createVector$1(t.x/e,t.y/e)},vectorRotate=(t,e,a)=>{const i=Math.cos(e),r=Math.sin(e),n=createVector$1(t.x-a.x,t.y-a.y);return createVector$1(a.x+i*n.x-r*n.y,a.y+r*n.x+i*n.y)},createVector$1=(t=0,e=0)=>({x:t,y:e}),getMarkupValue=(t,e,a=1,i)=>"string"==typeof t?parseFloat(t)*a:"number"==typeof t?t*(i?e[i]:Math.min(e.width,e.height)):void 0,getMarkupStyles=(t,e,a)=>{const i=t.borderStyle||t.lineStyle||"solid",r=t.backgroundColor||t.fontColor||"transparent",n=t.borderColor||t.lineColor||"transparent",o=getMarkupValue(t.borderWidth||t.lineWidth,e,a);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":o||0,"stroke-dasharray":"string"==typeof i?"":i.map((t=>getMarkupValue(t,e,a))).join(","),stroke:n,fill:r,opacity:t.opacity||1}},isDefined=t=>null!=t,getMarkupRect=(t,e,a=1)=>{let i=getMarkupValue(t.x,e,a,"width")||getMarkupValue(t.left,e,a,"width"),r=getMarkupValue(t.y,e,a,"height")||getMarkupValue(t.top,e,a,"height"),n=getMarkupValue(t.width,e,a,"width"),o=getMarkupValue(t.height,e,a,"height"),s=getMarkupValue(t.right,e,a,"width"),l=getMarkupValue(t.bottom,e,a,"height");return isDefined(r)||(r=isDefined(o)&&isDefined(l)?e.height-o-l:l),isDefined(i)||(i=isDefined(n)&&isDefined(s)?e.width-n-s:s),isDefined(n)||(n=isDefined(i)&&isDefined(s)?e.width-i-s:0),isDefined(o)||(o=isDefined(r)&&isDefined(l)?e.height-r-l:0),{x:i||0,y:r||0,width:n||0,height:o||0}},pointsToPathShape=t=>t.map(((t,e)=>`${0===e?"M":"L"} ${t.x} ${t.y}`)).join(" "),setAttributes=(t,e)=>Object.keys(e).forEach((a=>t.setAttribute(a,e[a]))),ns="http://www.w3.org/2000/svg",svg=(t,e)=>{const a=document.createElementNS(ns,t);return e&&setAttributes(a,e),a},updateRect=t=>setAttributes(t,{...t.rect,...t.styles}),updateEllipse=t=>{const e=t.rect.x+.5*t.rect.width,a=t.rect.y+.5*t.rect.height,i=.5*t.rect.width,r=.5*t.rect.height;return setAttributes(t,{cx:e,cy:a,rx:i,ry:r,...t.styles})},IMAGE_FIT_STYLE={contain:"xMidYMid meet",cover:"xMidYMid slice"},updateImage=(t,e)=>{setAttributes(t,{...t.rect,...t.styles,preserveAspectRatio:IMAGE_FIT_STYLE[e.fit]||"none"})},TEXT_ANCHOR={left:"start",center:"middle",right:"end"},updateText=(t,e,a,i)=>{const r=getMarkupValue(e.fontSize,a,i),n=e.fontFamily||"sans-serif",o=e.fontWeight||"normal",s=TEXT_ANCHOR[e.textAlign]||"start";setAttributes(t,{...t.rect,...t.styles,"stroke-width":0,"font-weight":o,"font-size":r,"font-family":n,"text-anchor":s}),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},updateLine=(t,e,a,i)=>{setAttributes(t,{...t.rect,...t.styles,fill:"none"});const r=t.childNodes[0],n=t.childNodes[1],o=t.childNodes[2],s=t.rect,l={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(setAttributes(r,{x1:s.x,y1:s.y,x2:l.x,y2:l.y}),!e.lineDecoration)return;n.style.display="none",o.style.display="none";const c=vectorNormalize({x:l.x-s.x,y:l.y-s.y}),h=getMarkupValue(.05,a,i);if(-1!==e.lineDecoration.indexOf("arrow-begin")){const t=vectorMultiply(c,h),e=vectorAdd(s,t),a=vectorRotate(s,2,e),i=vectorRotate(s,-2,e);setAttributes(n,{style:"display:block;",d:`M${a.x},${a.y} L${s.x},${s.y} L${i.x},${i.y}`})}if(-1!==e.lineDecoration.indexOf("arrow-end")){const t=vectorMultiply(c,-h),e=vectorAdd(l,t),a=vectorRotate(l,2,e),i=vectorRotate(l,-2,e);setAttributes(o,{style:"display:block;",d:`M${a.x},${a.y} L${l.x},${l.y} L${i.x},${i.y}`})}},updatePath=(t,e,a,i)=>{setAttributes(t,{...t.styles,fill:"none",d:pointsToPathShape(e.points.map((t=>({x:getMarkupValue(t.x,a,i,"width"),y:getMarkupValue(t.y,a,i,"height")}))))})},createShape=t=>e=>svg(t,{id:e.id}),createImage=t=>{const e=svg("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=()=>{e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},createLine=t=>{const e=svg("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),a=svg("line");e.appendChild(a);const i=svg("path");e.appendChild(i);const r=svg("path");return e.appendChild(r),e},CREATE_TYPE_ROUTES={image:createImage,rect:createShape("rect"),ellipse:createShape("ellipse"),text:createShape("text"),path:createShape("path"),line:createLine},UPDATE_TYPE_ROUTES={rect:updateRect,ellipse:updateEllipse,image:updateImage,text:updateText,path:updatePath,line:updateLine},createMarkupByType=(t,e)=>CREATE_TYPE_ROUTES[t](e),updateMarkupByType=(t,e,a,i,r)=>{"path"!==e&&(t.rect=getMarkupRect(a,i,r)),t.styles=getMarkupStyles(a,i,r),UPDATE_TYPE_ROUTES[e](t,a,i,r)},sortMarkupByZIndex=(t,e)=>t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0,cropSVG=(t,e={},a,i)=>new Promise((r=>{const{background:n=null}=i,o=new FileReader;o.onloadend=()=>{const t=o.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=t;const s=i.querySelector("svg");document.body.appendChild(i);const l=s.getBBox();i.parentNode.removeChild(i);const c=i.querySelector("title"),h=s.getAttribute("viewBox")||"",d=s.getAttribute("width")||"",u=s.getAttribute("height")||"";let g=parseFloat(d)||null,p=parseFloat(u)||null;const m=(d.match(/[a-z]+/)||[])[0]||"",y=(u.match(/[a-z]+/)||[])[0]||"",f=h.split(" ").map(parseFloat),M=f.length?{x:f[0],y:f[1],width:f[2],height:f[3]}:l;let w=null!=g?g:M.width,T=null!=p?p:M.height;s.style.overflow="visible",s.setAttribute("width",w),s.setAttribute("height",T);let x="";if(a&&a.length){const t={width:w,height:T};x=a.sort(sortMarkupByZIndex).reduce(((e,a)=>{const i=createMarkupByType(a[0],a[1]);return updateMarkupByType(i,a[0],a[1],t),i.removeAttribute("id"),1===i.getAttribute("opacity")&&i.removeAttribute("opacity"),e+"\n"+i.outerHTML+"\n"}),""),x=`\n\n<g>${x.replace(/&nbsp;/g," ")}</g>\n\n`}const R=e.aspectRatio||T/w,A=w,v=A*R,E=void 0===e.scaleToFit||e.scaleToFit,b=e.center?e.center.x:.5,I=e.center?e.center.y:.5,S=getImageRectZoomFactor({width:w,height:T},getCenteredCropRect({width:A,height:v},R),e.rotation,E?{x:b,y:I}:{x:.5,y:.5}),k=e.zoom*S,_=.5*A,O=.5*v,C=[`rotate(${e.rotation*(180/Math.PI)} ${_} ${O})`,`translate(${_} ${O})`,`scale(${k})`,`translate(${-_} ${-O})`,`translate(${_-w*b} ${O-T*I})`],B=e.flip&&e.flip.horizontal,L=e.flip&&e.flip.vertical,U=[`scale(${B?-1:1} ${L?-1:1})`,`translate(${B?-w:0} ${L?-T:0})`],N=`<?xml version="1.0" encoding="UTF-8"?>\n<svg width="${A}${m}" height="${v}${y}" \nviewBox="0 0 ${A} ${v}" ${n?'style="background:'+n+'" ':""}\npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>${c?c.textContent:""}</title>\n<g transform="${C.join(" ")}">\n<g transform="${U.join(" ")}">\n${s.outerHTML}${x}\n</g>\n</g>\n</svg>`;r(N)},o.readAsText(t)})),objectToImageData=t=>{let e;try{e=new ImageData(t.width,t.height)}catch(a){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},TransformWorker=()=>{const t={resize:function(t,e){let{mode:a="contain",upscale:i=!1,width:r,height:o,matrix:c}=e;if(c=!c||s(c)?null:c,!r&&!o)return l(t,c);null===r?r=o:null===o&&(o=r);if("force"!==a){let e=r/t.width,n=o/t.height,s=1;if("cover"===a?s=Math.max(e,n):"contain"===a&&(s=Math.min(e,n)),s>1&&!1===i)return l(t,c);r=t.width*s,o=t.height*s}const h=t.width,d=t.height,u=Math.round(r),g=Math.round(o),p=t.data,m=new Uint8ClampedArray(u*g*4),y=h/u,f=d/g,M=Math.ceil(.5*y),w=Math.ceil(.5*f);for(let t=0;t<g;t++)for(let e=0;e<u;e++){let a=4*(e+t*u),i=0,r=0,o=0,s=0,l=0,d=0,g=0,T=(t+.5)*f;for(let a=Math.floor(t*f);a<(t+1)*f;a++){let t=Math.abs(T-(a+.5))/w,n=(e+.5)*y,c=t*t;for(let t=Math.floor(e*y);t<(e+1)*y;t++){let e=Math.abs(n-(t+.5))/M,u=Math.sqrt(c+e*e);if(u>=-1&&u<=1&&(i=2*u*u*u-3*u*u+1,i>0)){e=4*(t+a*h);let n=p[e+3];g+=i*n,o+=i,n<255&&(i=i*n/250),s+=i*p[e],l+=i*p[e+1],d+=i*p[e+2],r+=i}}}m[a]=s/r,m[a+1]=l/r,m[a+2]=d/r,m[a+3]=g/o,c&&n(a,m,c)}return{data:m,width:u,height:g}},filter:l},e=(e,a)=>{let i=e.transforms,r=null;if(i.forEach((t=>{"filter"===t.type&&(r=t)})),r){let t=null;i.forEach((e=>{"resize"===e.type&&(t=e)})),t&&(t.data.matrix=r.data,i=i.filter((t=>"filter"!==t.type)))}a(((e,a)=>(e.forEach((e=>{a=t[e.type](a,e.data)})),a))(i,e.imageData))};self.onmessage=t=>{e(t.data.message,(e=>{self.postMessage({id:t.data.id,message:e},[e.data.buffer])}))};const a=1,i=1,r=1;function n(t,e,n){const o=e[t]/255,s=e[t+1]/255,l=e[t+2]/255,c=e[t+3]/255,h=o*n[0]+s*n[1]+l*n[2]+c*n[3]+n[4],d=o*n[5]+s*n[6]+l*n[7]+c*n[8]+n[9],u=o*n[10]+s*n[11]+l*n[12]+c*n[13]+n[14],g=o*n[15]+s*n[16]+l*n[17]+c*n[18]+n[19],p=Math.max(0,h*g)+a*(1-g),m=Math.max(0,d*g)+i*(1-g),y=Math.max(0,u*g)+r*(1-g);e[t]=255*Math.max(0,Math.min(1,p)),e[t+1]=255*Math.max(0,Math.min(1,m)),e[t+2]=255*Math.max(0,Math.min(1,y))}const o=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function s(t){return self.JSON.stringify(t||[])===o}function l(t,e){if(!e||s(e))return t;const n=t.data,o=n.length,l=e[0],c=e[1],h=e[2],d=e[3],u=e[4],g=e[5],p=e[6],m=e[7],y=e[8],f=e[9],M=e[10],w=e[11],T=e[12],x=e[13],R=e[14],A=e[15],v=e[16],E=e[17],b=e[18],I=e[19];let S=0,k=0,_=0,O=0,C=0,B=0,L=0,U=0,N=0,P=0,F=0,D=0;for(;S<o;S+=4)k=n[S]/255,_=n[S+1]/255,O=n[S+2]/255,C=n[S+3]/255,B=k*l+_*c+O*h+C*d+u,L=k*g+_*p+O*m+C*y+f,U=k*M+_*w+O*T+C*x+R,N=k*A+_*v+O*E+C*b+I,P=Math.max(0,B*N)+a*(1-N),F=Math.max(0,L*N)+i*(1-N),D=Math.max(0,U*N)+r*(1-N),n[S]=255*Math.max(0,Math.min(1,P)),n[S+1]=255*Math.max(0,Math.min(1,F)),n[S+2]=255*Math.max(0,Math.min(1,D));return t}},correctOrientation=(t,e)=>{if(1165519206!==t.getUint32(e+4,!1))return;e+=4;const a=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,a);const i=t.getUint16(e,a);e+=2;for(let r=0;r<i;r++)if(274===t.getUint16(e+12*r,a))return t.setUint16(e+12*r+8,1,a),!0;return!1},readData=t=>{const e=new DataView(t);if(65496!==e.getUint16(0))return null;let a,i,r=2,n=!1;for(;r<e.byteLength;){a=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2;if(!(a>=65504&&a<=65519||65534===a))break;if(n||(n=correctOrientation(e,r)),r+i>e.byteLength)break;r+=i}return t.slice(0,r)},getImageHead=t=>new Promise((e=>{const a=new FileReader;a.onload=()=>e(readData(a.result)||null),a.readAsArrayBuffer(t.slice(0,262144))})),getBlobBuilder=()=>window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,createBlob=(t,e)=>{const a=getBlobBuilder();if(a){const i=new a;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},getUniqueId=()=>Math.random().toString(36).substr(2,9),createWorker=t=>{const e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),a=URL.createObjectURL(e),i=new Worker(a),r=[];return{transfer:()=>{},post:(t,e,a)=>{const n=getUniqueId();r[n]=e,i.onmessage=t=>{const e=r[t.data.id];e&&(e(t.data.message),delete r[t.data.id])},i.postMessage({id:n,message:t},a)},terminate:()=>{i.terminate(),URL.revokeObjectURL(a)}}},loadImage=t=>new Promise(((e,a)=>{const i=new Image;i.onload=()=>{e(i)},i.onerror=t=>{a(t)},i.src=t})),chain=t=>t.reduce(((t,e)=>t.then((t=>e().then(Array.prototype.concat.bind(t))))),Promise.resolve([])),canvasApplyMarkup=(t,e)=>new Promise((a=>{const i={width:t.width,height:t.height},r=t.getContext("2d"),n=e.sort(sortMarkupByZIndex).map((t=>()=>new Promise((e=>{TYPE_DRAW_ROUTES[t[0]](r,i,t[1],e)&&e()}))));chain(n).then((()=>a(t)))})),applyMarkupStyles=(t,e)=>{t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},drawMarkupStyles=t=>{t.fill(),t.stroke(),t.globalAlpha=1},drawRect=(t,e,a)=>{const i=getMarkupRect(a,e),r=getMarkupStyles(a,e);return applyMarkupStyles(t,r),t.rect(i.x,i.y,i.width,i.height),drawMarkupStyles(t),!0},drawEllipse=(t,e,a)=>{const i=getMarkupRect(a,e),r=getMarkupStyles(a,e);applyMarkupStyles(t,r);const n=i.x,o=i.y,s=i.width,l=i.height,c=.5522848,h=s/2*c,d=l/2*c,u=n+s,g=o+l,p=n+s/2,m=o+l/2;return t.moveTo(n,m),t.bezierCurveTo(n,m-d,p-h,o,p,o),t.bezierCurveTo(p+h,o,u,m-d,u,m),t.bezierCurveTo(u,m+d,p+h,g,p,g),t.bezierCurveTo(p-h,g,n,m+d,n,m),drawMarkupStyles(t),!0},drawImage=(t,e,a,i)=>{const r=getMarkupRect(a,e),n=getMarkupStyles(a,e);applyMarkupStyles(t,n);const o=new Image;new URL(a.src,window.location.href).origin!==window.location.origin&&(o.crossOrigin=""),o.onload=()=>{if("cover"===a.fit){const e=r.width/r.height,a=e>1?o.width:o.height*e,i=e>1?o.width/e:o.height,n=.5*o.width-.5*a,s=.5*o.height-.5*i;t.drawImage(o,n,s,a,i,r.x,r.y,r.width,r.height)}else if("contain"===a.fit){const e=Math.min(r.width/o.width,r.height/o.height),a=e*o.width,i=e*o.height,n=r.x+.5*r.width-.5*a,s=r.y+.5*r.height-.5*i;t.drawImage(o,0,0,o.width,o.height,n,s,a,i)}else t.drawImage(o,0,0,o.width,o.height,r.x,r.y,r.width,r.height);drawMarkupStyles(t),i()},o.src=a.src},drawText=(t,e,a)=>{const i=getMarkupRect(a,e),r=getMarkupStyles(a,e);applyMarkupStyles(t,r);const n=getMarkupValue(a.fontSize,e),o=a.fontFamily||"sans-serif",s=a.fontWeight||"normal",l=a.textAlign||"left";return t.font=`${s} ${n}px ${o}`,t.textAlign=l,t.fillText(a.text,i.x,i.y),drawMarkupStyles(t),!0},drawPath=(t,e,a)=>{const i=getMarkupStyles(a,e);applyMarkupStyles(t,i),t.beginPath();const r=a.points.map((t=>({x:getMarkupValue(t.x,e,1,"width"),y:getMarkupValue(t.y,e,1,"height")})));t.moveTo(r[0].x,r[0].y);const n=r.length;for(let e=1;e<n;e++)t.lineTo(r[e].x,r[e].y);return drawMarkupStyles(t),!0},drawLine=(t,e,a)=>{const i=getMarkupRect(a,e),r=getMarkupStyles(a,e);applyMarkupStyles(t,r),t.beginPath();const n={x:i.x,y:i.y},o={x:i.x+i.width,y:i.y+i.height};t.moveTo(n.x,n.y),t.lineTo(o.x,o.y);const s=vectorNormalize({x:o.x-n.x,y:o.y-n.y}),l=.04*Math.min(e.width,e.height);if(-1!==a.lineDecoration.indexOf("arrow-begin")){const e=vectorMultiply(s,l),a=vectorAdd(n,e),i=vectorRotate(n,2,a),r=vectorRotate(n,-2,a);t.moveTo(i.x,i.y),t.lineTo(n.x,n.y),t.lineTo(r.x,r.y)}if(-1!==a.lineDecoration.indexOf("arrow-end")){const e=vectorMultiply(s,-l),a=vectorAdd(o,e),i=vectorRotate(o,2,a),r=vectorRotate(o,-2,a);t.moveTo(i.x,i.y),t.lineTo(o.x,o.y),t.lineTo(r.x,r.y)}return drawMarkupStyles(t),!0},TYPE_DRAW_ROUTES={rect:drawRect,ellipse:drawEllipse,image:drawImage,text:drawText,line:drawLine,path:drawPath},imageDataToCanvas=t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;return e.getContext("2d").putImageData(t,0,0),e},transformImage=(t,e,a={})=>new Promise(((i,r)=>{if(!t||!isImage$1(t))return r({status:"not an image file",file:t});const{stripImageHead:n,beforeCreateBlob:o,afterCreateBlob:s,canvasMemoryLimit:l}=a,{crop:c,size:h,filter:d,markup:u,output:g}=e,p=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,m=g&&g.quality,y=null===m?null:m/100,f=g&&g.type||null,M=g&&g.background||null,w=[];!h||"number"!=typeof h.width&&"number"!=typeof h.height||w.push({type:"resize",data:h}),d&&20===d.length&&w.push({type:"filter",data:d});const T=t=>{const e=s?s(t):t;Promise.resolve(e).then(i)},x=(e,a)=>{const i=imageDataToCanvas(e),s=u.length?canvasApplyMarkup(i,u):i;Promise.resolve(s).then((e=>{canvasToBlob(e,a,o).then((a=>{if(canvasRelease(e),n)return T(a);getImageHead(t).then((t=>{null!==t&&(a=new Blob([t,a.slice(20)],{type:a.type})),T(a)}))})).catch(r)}))};if(/svg/.test(t.type)&&null===f)return cropSVG(t,c,u,{background:M}).then((t=>{i(createBlob(t,"image/svg+xml"))}));const R=URL.createObjectURL(t);loadImage(R).then((e=>{URL.revokeObjectURL(R);const a=imageToImageData(e,p,c,{canvasMemoryLimit:l,background:M}),i={quality:y,type:f||t.type};if(!w.length)return x(a,i);const r=createWorker(TransformWorker);r.post({transforms:w,imageData:a},(t=>{x(objectToImageData(t),i),r.terminate()}),[a.data.buffer])})).catch(r)})),MARKUP_RECT=["x","y","left","top","right","bottom","width","height"],toOptionalFraction=t=>"string"==typeof t&&/%/.test(t)?parseFloat(t)/100:t,prepareMarkup=t=>{const[e,a]=t,i=a.points?{}:MARKUP_RECT.reduce(((t,e)=>(t[e]=toOptionalFraction(a[e]),t)),{});return[e,{zIndex:0,...a,...i}]},getImageSize=t=>new Promise(((e,a)=>{const i=new Image;i.src=URL.createObjectURL(t);const r=()=>{const t=i.naturalWidth,a=i.naturalHeight;t&&a&&(URL.revokeObjectURL(i.src),clearInterval(n),e({width:t,height:a}))};i.onerror=t=>{URL.revokeObjectURL(i.src),clearInterval(n),a(t)};const n=setInterval(r,1);r()}));"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,a){const i=this;setTimeout((()=>{const r=i.toDataURL(e,a).split(",")[1],n=atob(r);let o=n.length;const s=new Uint8Array(o);for(;o--;)s[o]=n.charCodeAt(o);t(new Blob([s],{type:e||"image/png"}))}))}}));const isBrowser="undefined"!=typeof window&&void 0!==window.document,isIOS=isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,plugin=({addFilter:t,utils:e})=>{const{Type:a,forin:i,getFileFromBlob:r,isFile:n}=e,o=["crop","resize","filter","markup","output"],s=t=>null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical;t("SHOULD_PREPARE_OUTPUT",((t,{query:e})=>new Promise((t=>{t(!e("IS_ASYNC"))}))));return t("DID_CREATE_ITEM",((t,{query:e,dispatch:a})=>{e("GET_ALLOW_IMAGE_TRANSFORM")&&t.extend("requestPrepare",(()=>new Promise(((e,i)=>{a("REQUEST_PREPARE_OUTPUT",{query:t.id,item:t,success:e,failure:i},!0)}))))})),t("PREPARE_OUTPUT",((t,{query:e,item:a})=>new Promise((l=>{((t,e,a)=>new Promise((i=>{if(!t("GET_ALLOW_IMAGE_TRANSFORM")||a.archived||!n(e)||!isImage(e))return i(!1);getImageSize(e).then((()=>{const a=t("GET_IMAGE_TRANSFORM_IMAGE_FILTER");if(a){const t=a(e);if(null==t)return handleRevert(!0);if("boolean"==typeof t)return i(t);if("function"==typeof t.then)return t.then(i)}i(!0)})).catch((t=>{i(!1)}))})))(e,t,a).then((n=>{if(!n)return l(t);const c=[];e("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&c.push((()=>new Promise((a=>{a({name:e("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:t})})))),e("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&c.push(((t,a,i)=>new Promise((r=>{t(a,i).then((t=>r({name:e("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})))}))));const h=e("GET_IMAGE_TRANSFORM_VARIANTS")||{};i(h,((t,e)=>{const a=(i=e,(t,e,a)=>t(e,i?i(a):a));var i;c.push(((e,i,r)=>new Promise((n=>{a(e,i,r).then((e=>n({name:t,file:e})))}))))}));const d=e("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),u=e("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),g=null===d?null:d/100,p=e("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),m=e("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||o;a.setMetadata("output",{type:p,quality:g,client:m},!0);const y=(t,a)=>new Promise(((i,n)=>{const o={...a};Object.keys(o).filter((t=>"exif"!==t)).forEach((t=>{-1===m.indexOf(t)&&delete o[t]}));const{resize:l,exif:c,output:h,crop:d,filter:g,markup:p}=o,y={image:{orientation:c?c.orientation:null},output:h&&(h.type||"number"==typeof h.quality||h.background)?{type:h.type,quality:"number"==typeof h.quality?100*h.quality:null,background:h.background||e("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR")||null}:void 0,size:l&&(l.size.width||l.size.height)?{mode:l.mode,upscale:l.upscale,...l.size}:void 0,crop:d&&!s(d)?{...d}:void 0,markup:p&&p.length?p.map(prepareMarkup):[],filter:g};if(y.output){const e=!!h.type&&h.type!==t.type,a=/\/jpe?g$/.test(t.type),r=null!==h.quality&&(a&&"always"===u);if(!!!(y.size||y.crop||y.filter||e||r))return i(t)}const f={beforeCreateBlob:e("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:e("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:e("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:e("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};transformImage(t,y,f).then((e=>{const a=r(e,renameFileToMatchMimeType(t.name,getValidOutputMimeType(e.type)));i(a)})).catch(n)})),f=c.map((e=>e(y,t,a.getMetadata())));Promise.all(f).then((t=>{l(1===t.length&&null===t[0].name?t[0].file:t)}))}))})))),{options:{allowImageTransform:[!0,a.BOOLEAN],imageTransformImageFilter:[null,a.FUNCTION],imageTransformOutputMimeType:[null,a.STRING],imageTransformOutputQuality:[null,a.INT],imageTransformOutputStripImageHead:[!0,a.BOOLEAN],imageTransformClientTransforms:[null,a.ARRAY],imageTransformOutputQualityMode:["always",a.STRING],imageTransformVariants:[null,a.OBJECT],imageTransformVariantsIncludeDefault:[!0,a.BOOLEAN],imageTransformVariantsDefaultName:[null,a.STRING],imageTransformVariantsIncludeOriginal:[!1,a.BOOLEAN],imageTransformVariantsOriginalName:["original_",a.STRING],imageTransformBeforeCreateBlob:[null,a.FUNCTION],imageTransformAfterCreateBlob:[null,a.FUNCTION],imageTransformCanvasMemoryLimit:[isBrowser&&isIOS?16777216:null,a.INT],imageTransformCanvasBackgroundColor:[null,a.STRING]}}};isBrowser&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin}));export default plugin;