export class FilepondImageResolutionValidator{static tags=[{event:"contao_filepond:process_start",priority:90}];async handle(e){const i=e.file;if(!this.isImage(i))return;const t=e.filepondOptions,o=Number(e.jsConfig.minImageWidth)||0,a=Number(e.jsConfig.minImageHeight)||0,r=Number(e.jsConfig.maxImageWidth)||0,n=Number(e.jsConfig.maxImageHeight)||0;if(!(i instanceof Blob))throw new Error(t.labelImageValidateSizeLabelFormatError);let l,s;try{({width:l,height:s}=await this.loadImage(i))}catch(e){return void console.log(`Skip resolution validator: Could not load image from ${i.name}.`)}if(Number.isFinite(l)&&Number.isFinite(s)){if(l<o||s<a){const e={width:l,height:s,minWidth:o,minHeight:a},i=t.labelMinImageResolutionValidationError.replace(/\{(\w+)\}/g,(i,t)=>e[t]);throw new Error(i)}if(r&&(l>r||s>n)){const e={width:l,height:s,maxWidth:r,maxHeight:n},i=t.labelMaxImageResolutionValidationError.replace(/\{(\w+)\}/g,(i,t)=>e[t]);throw new Error(i)}}else console.log(`Skip resolution validator: Invalid resolution for ${i.name}.`)}loadImage(e){return new Promise((i,t)=>{const o=new Image,a=URL.createObjectURL(e);o.onload=()=>{URL.revokeObjectURL(a),i({width:o.naturalWidth,height:o.naturalHeight})},o.onerror=()=>{URL.revokeObjectURL(a),t(new Error("Invalid image, cannot extract resolution."))},o.src=a})}isImage(e){return/^image\//.test(e.type)||/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(e.name)}}