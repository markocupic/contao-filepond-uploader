/*! For license information please see filepond-plugin-image-preview.esm.ed415402.js.LICENSE.txt */
const isPreviewableImage=e=>/^image/.test(e.type),vectorMultiply=(e,t)=>createVector(e.x*t,e.y*t),vectorAdd=(e,t)=>createVector(e.x+t.x,e.y+t.y),vectorNormalize=e=>{const t=Math.sqrt(e.x*e.x+e.y*e.y);return 0===t?{x:0,y:0}:createVector(e.x/t,e.y/t)},vectorRotate=(e,t,a)=>{const r=Math.cos(t),i=Math.sin(t),o=createVector(e.x-a.x,e.y-a.y);return createVector(a.x+r*o.x-i*o.y,a.y+i*o.x+r*o.y)},createVector=(e=0,t=0)=>({x:e,y:t}),getMarkupValue=(e,t,a=1,r)=>"string"==typeof e?parseFloat(e)*a:"number"==typeof e?e*(r?t[r]:Math.min(t.width,t.height)):void 0,getMarkupStyles=(e,t,a)=>{const r=e.borderStyle||e.lineStyle||"solid",i=e.backgroundColor||e.fontColor||"transparent",o=e.borderColor||e.lineColor||"transparent",n=getMarkupValue(e.borderWidth||e.lineWidth,t,a);return{"stroke-linecap":e.lineCap||"round","stroke-linejoin":e.lineJoin||"round","stroke-width":n||0,"stroke-dasharray":"string"==typeof r?"":r.map(e=>getMarkupValue(e,t,a)).join(","),stroke:o,fill:i,opacity:e.opacity||1}},isDefined=e=>null!=e,getMarkupRect=(e,t,a=1)=>{let r=getMarkupValue(e.x,t,a,"width")||getMarkupValue(e.left,t,a,"width"),i=getMarkupValue(e.y,t,a,"height")||getMarkupValue(e.top,t,a,"height"),o=getMarkupValue(e.width,t,a,"width"),n=getMarkupValue(e.height,t,a,"height"),s=getMarkupValue(e.right,t,a,"width"),c=getMarkupValue(e.bottom,t,a,"height");return isDefined(i)||(i=isDefined(n)&&isDefined(c)?t.height-n-c:c),isDefined(r)||(r=isDefined(o)&&isDefined(s)?t.width-o-s:s),isDefined(o)||(o=isDefined(r)&&isDefined(s)?t.width-r-s:0),isDefined(n)||(n=isDefined(i)&&isDefined(c)?t.height-i-c:0),{x:r||0,y:i||0,width:o||0,height:n||0}},pointsToPathShape=e=>e.map((e,t)=>`${0===t?"M":"L"} ${e.x} ${e.y}`).join(" "),setAttributes=(e,t)=>Object.keys(t).forEach(a=>e.setAttribute(a,t[a])),ns="http://www.w3.org/2000/svg",svg=(e,t)=>{const a=document.createElementNS(ns,e);return t&&setAttributes(a,t),a},updateRect=e=>setAttributes(e,{...e.rect,...e.styles}),updateEllipse=e=>{const t=e.rect.x+.5*e.rect.width,a=e.rect.y+.5*e.rect.height,r=.5*e.rect.width,i=.5*e.rect.height;return setAttributes(e,{cx:t,cy:a,rx:r,ry:i,...e.styles})},IMAGE_FIT_STYLE={contain:"xMidYMid meet",cover:"xMidYMid slice"},updateImage=(e,t)=>{setAttributes(e,{...e.rect,...e.styles,preserveAspectRatio:IMAGE_FIT_STYLE[t.fit]||"none"})},TEXT_ANCHOR={left:"start",center:"middle",right:"end"},updateText=(e,t,a,r)=>{const i=getMarkupValue(t.fontSize,a,r),o=t.fontFamily||"sans-serif",n=t.fontWeight||"normal",s=TEXT_ANCHOR[t.textAlign]||"start";setAttributes(e,{...e.rect,...e.styles,"stroke-width":0,"font-weight":n,"font-size":i,"font-family":o,"text-anchor":s}),e.text!==t.text&&(e.text=t.text,e.textContent=t.text.length?t.text:" ")},updateLine=(e,t,a,r)=>{setAttributes(e,{...e.rect,...e.styles,fill:"none"});const i=e.childNodes[0],o=e.childNodes[1],n=e.childNodes[2],s=e.rect,c={x:e.rect.x+e.rect.width,y:e.rect.y+e.rect.height};if(setAttributes(i,{x1:s.x,y1:s.y,x2:c.x,y2:c.y}),!t.lineDecoration)return;o.style.display="none",n.style.display="none";const l=vectorNormalize({x:c.x-s.x,y:c.y-s.y}),h=getMarkupValue(.05,a,r);if(-1!==t.lineDecoration.indexOf("arrow-begin")){const e=vectorMultiply(l,h),t=vectorAdd(s,e),a=vectorRotate(s,2,t),r=vectorRotate(s,-2,t);setAttributes(o,{style:"display:block;",d:`M${a.x},${a.y} L${s.x},${s.y} L${r.x},${r.y}`})}if(-1!==t.lineDecoration.indexOf("arrow-end")){const e=vectorMultiply(l,-h),t=vectorAdd(c,e),a=vectorRotate(c,2,t),r=vectorRotate(c,-2,t);setAttributes(n,{style:"display:block;",d:`M${a.x},${a.y} L${c.x},${c.y} L${r.x},${r.y}`})}},updatePath=(e,t,a,r)=>{setAttributes(e,{...e.styles,fill:"none",d:pointsToPathShape(t.points.map(e=>({x:getMarkupValue(e.x,a,r,"width"),y:getMarkupValue(e.y,a,r,"height")})))})},createShape=e=>t=>svg(e,{id:t.id}),createImage=e=>{const t=svg("image",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return t.onload=()=>{t.setAttribute("opacity",e.opacity||1)},t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.src),t},createLine=e=>{const t=svg("g",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round"}),a=svg("line");t.appendChild(a);const r=svg("path");t.appendChild(r);const i=svg("path");return t.appendChild(i),t},CREATE_TYPE_ROUTES={image:createImage,rect:createShape("rect"),ellipse:createShape("ellipse"),text:createShape("text"),path:createShape("path"),line:createLine},UPDATE_TYPE_ROUTES={rect:updateRect,ellipse:updateEllipse,image:updateImage,text:updateText,path:updatePath,line:updateLine},createMarkupByType=(e,t)=>CREATE_TYPE_ROUTES[e](t),updateMarkupByType=(e,t,a,r,i)=>{"path"!==t&&(e.rect=getMarkupRect(a,r,i)),e.styles=getMarkupStyles(a,r,i),UPDATE_TYPE_ROUTES[t](e,a,r,i)},MARKUP_RECT=["x","y","left","top","right","bottom","width","height"],toOptionalFraction=e=>"string"==typeof e&&/%/.test(e)?parseFloat(e)/100:e,prepareMarkup=e=>{const[t,a]=e,r=a.points?{}:MARKUP_RECT.reduce((e,t)=>(e[t]=toOptionalFraction(a[t]),e),{});return[t,{zIndex:0,...a,...r}]},sortMarkupByZIndex=(e,t)=>e[1].zIndex>t[1].zIndex?1:e[1].zIndex<t[1].zIndex?-1:0,createMarkupView=e=>e.utils.createView({name:"image-preview-markup",tag:"svg",ignoreRect:!0,mixins:{apis:["width","height","crop","markup","resize","dirty"]},write:({root:e,props:t})=>{if(!t.dirty)return;const{crop:a,resize:r,markup:i}=t,o=t.width,n=t.height;let s=a.width,c=a.height;if(r){const{size:e}=r;let t=e&&e.width,a=e&&e.height;const i=r.mode,o=r.upscale;t&&!a&&(a=t),a&&!t&&(t=a);const n=s<t&&c<a;if(!n||n&&o){let e=t/s,r=a/c;if("force"===i)s=t,c=a;else{let t;"cover"===i?t=Math.max(e,r):"contain"===i&&(t=Math.min(e,r)),s*=t,c*=t}}}const l={width:o,height:n};e.element.setAttribute("width",l.width),e.element.setAttribute("height",l.height);const h=Math.min(o/s,n/c);e.element.innerHTML="";const d=e.query("GET_IMAGE_PREVIEW_MARKUP_FILTER");i.filter(d).map(prepareMarkup).sort(sortMarkupByZIndex).forEach(t=>{const[a,r]=t,i=createMarkupByType(a,r);updateMarkupByType(i,a,r,l,h),e.element.appendChild(i)})}}),createVector$1=(e,t)=>({x:e,y:t}),vectorDot=(e,t)=>e.x*t.x+e.y*t.y,vectorSubtract=(e,t)=>createVector$1(e.x-t.x,e.y-t.y),vectorDistanceSquared=(e,t)=>vectorDot(vectorSubtract(e,t),vectorSubtract(e,t)),vectorDistance=(e,t)=>Math.sqrt(vectorDistanceSquared(e,t)),getOffsetPointOnEdge=(e,t)=>{const a=e,r=t,i=1.5707963267948966-t,o=Math.sin(1.5707963267948966),n=Math.sin(r),s=Math.sin(i),c=Math.cos(i),l=a/o;return createVector$1(c*(l*n),c*(l*s))},getRotatedRectSize=(e,t)=>{const a=e.width,r=e.height,i=getOffsetPointOnEdge(a,t),o=getOffsetPointOnEdge(r,t),n=createVector$1(e.x+Math.abs(i.x),e.y-Math.abs(i.y)),s=createVector$1(e.x+e.width+Math.abs(o.y),e.y+Math.abs(o.x)),c=createVector$1(e.x-Math.abs(o.y),e.y+e.height-Math.abs(o.x));return{width:vectorDistance(n,s),height:vectorDistance(n,c)}},calculateCanvasSize=(e,t,a=1)=>{const r=e.height/e.width;let i=t,o=1,n=r;n>i&&(n=i,o=n/r);const s=Math.max(1/o,i/n),c=e.width/(a*s*o);return{width:c,height:c*t}},getImageRectZoomFactor=(e,t,a,r)=>{const i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,n=2*i*e.width,s=2*o*e.height,c=getRotatedRectSize(t,a);return Math.max(c.width/n,c.height/s)},getCenteredCropRect=(e,t)=>{let a=e.width,r=a*t;r>e.height&&(r=e.height,a=r/t);return{x:.5*(e.width-a),y:.5*(e.height-r),width:a,height:r}},getCurrentCropSize=(e,t={})=>{let{zoom:a,rotation:r,center:i,aspectRatio:o}=t;o||(o=e.height/e.width);const n=calculateCanvasSize(e,o,a),s={x:.5*n.width,y:.5*n.height},c={x:0,y:0,width:n.width,height:n.height,center:s},l=void 0===t.scaleToFit||t.scaleToFit,h=a*getImageRectZoomFactor(e,getCenteredCropRect(c,o),r,l?i:{x:.5,y:.5});return{widthFloat:n.width/h,heightFloat:n.height/h,width:Math.round(n.width/h),height:Math.round(n.height/h)}},IMAGE_SCALE_SPRING_PROPS={type:"spring",stiffness:.5,damping:.45,mass:10},createBitmapView=e=>e.utils.createView({name:"image-bitmap",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:({root:e,props:t})=>{e.appendChild(t.image)}}),createImageCanvasWrapper=e=>e.utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:IMAGE_SCALE_SPRING_PROPS,originY:IMAGE_SCALE_SPRING_PROPS,scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,translateX:IMAGE_SCALE_SPRING_PROPS,translateY:IMAGE_SCALE_SPRING_PROPS,rotateZ:IMAGE_SCALE_SPRING_PROPS}},create:({root:t,props:a})=>{a.width=a.image.width,a.height=a.image.height,t.ref.bitmap=t.appendChildView(t.createChildView(createBitmapView(e),{image:a.image}))},write:({root:e,props:t})=>{const{flip:a}=t.crop,{bitmap:r}=e.ref;r.scaleX=a.horizontal?-1:1,r.scaleY=a.vertical?-1:1}}),createClipView=e=>e.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","markup","resize","width","height","dirty","background"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},didWriteView:function({root:e,props:t}){t.background&&(e.element.style.backgroundColor=t.background)},create:({root:t,props:a})=>{t.ref.image=t.appendChildView(t.createChildView(createImageCanvasWrapper(e),Object.assign({},a))),t.ref.createMarkup=()=>{t.ref.markup||(t.ref.markup=t.appendChildView(t.createChildView(createMarkupView(e),Object.assign({},a))))},t.ref.destroyMarkup=()=>{t.ref.markup&&(t.removeChildView(t.ref.markup),t.ref.markup=null)};const r=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==r&&(t.element.dataset.transparencyIndicator="grid"===r?r:"color")},write:({root:e,props:t,shouldOptimize:a})=>{const{crop:r,markup:i,resize:o,dirty:n,width:s,height:c}=t;e.ref.image.crop=r;const l={x:0,y:0,width:s,height:c,center:{x:.5*s,y:.5*c}},h={width:e.ref.image.width,height:e.ref.image.height},d={x:r.center.x*h.width,y:r.center.y*h.height},p={x:l.center.x-h.width*r.center.x,y:l.center.y-h.height*r.center.y},g=2*Math.PI+r.rotation%(2*Math.PI),u=r.aspectRatio||h.height/h.width,m=void 0===r.scaleToFit||r.scaleToFit,E=getImageRectZoomFactor(h,getCenteredCropRect(l,u),g,m?r.center:{x:.5,y:.5}),_=r.zoom*E;i&&i.length?(e.ref.createMarkup(),e.ref.markup.width=s,e.ref.markup.height=c,e.ref.markup.resize=o,e.ref.markup.dirty=n,e.ref.markup.markup=i,e.ref.markup.crop=getCurrentCropSize(h,r)):e.ref.markup&&e.ref.destroyMarkup();const I=e.ref.image;if(a)return I.originX=null,I.originY=null,I.translateX=null,I.translateY=null,I.rotateZ=null,I.scaleX=null,void(I.scaleY=null);I.originX=d.x,I.originY=d.y,I.translateX=p.x,I.translateY=p.y,I.rotateZ=g,I.scaleX=_,I.scaleY=_}}),createImageView=e=>e.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["image","crop","markup","resize","dirty","background"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,translateY:IMAGE_SCALE_SPRING_PROPS,opacity:{type:"tween",duration:400}}},create:({root:t,props:a})=>{t.ref.clip=t.appendChildView(t.createChildView(createClipView(e),{id:a.id,image:a.image,crop:a.crop,markup:a.markup,resize:a.resize,dirty:a.dirty,background:a.background}))},write:({root:e,props:t,shouldOptimize:a})=>{const{clip:r}=e.ref,{image:i,crop:o,markup:n,resize:s,dirty:c}=t;if(r.crop=o,r.markup=n,r.resize=s,r.dirty=c,r.opacity=a?0:1,a||e.rect.element.hidden)return;const l=i.height/i.width;let h=o.aspectRatio||l;const d=e.rect.inner.width,p=e.rect.inner.height;let g=e.query("GET_IMAGE_PREVIEW_HEIGHT");const u=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),m=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),E=e.query("GET_PANEL_ASPECT_RATIO"),_=e.query("GET_ALLOW_MULTIPLE");E&&!_&&(g=d*E,h=E);let I=null!==g?g:Math.max(u,Math.min(d*h,m)),f=I/h;f>d&&(f=d,I=f*h),I>p&&(I=p,f=p/h),r.width=f,r.height=I}});let SVG_MASK='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>',SVGMaskUniqueId=0;const createImageOverlayView=e=>e.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{let a=SVG_MASK;if(document.querySelector("base")){const e=new URL(window.location.href.replace(window.location.hash,"")).href;a=a.replace(/url\(\#/g,"url("+e+"#")}SVGMaskUniqueId++,e.element.classList.add(`filepond--image-preview-overlay-${t.status}`),e.element.innerHTML=a.replace(/__UID__/g,SVGMaskUniqueId)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),BitmapWorker=function(){self.onmessage=e=>{createImageBitmap(e.data.message.file).then(t=>{self.postMessage({id:e.data.id,message:t},[t])})}},ColorMatrixWorker=function(){self.onmessage=e=>{const t=e.data.message.imageData,a=e.data.message.colorMatrix,r=t.data,i=r.length,o=a[0],n=a[1],s=a[2],c=a[3],l=a[4],h=a[5],d=a[6],p=a[7],g=a[8],u=a[9],m=a[10],E=a[11],_=a[12],I=a[13],f=a[14],y=a[15],w=a[16],M=a[17],A=a[18],R=a[19];let T=0,x=0,P=0,v=0,C=0;for(;T<i;T+=4)x=r[T]/255,P=r[T+1]/255,v=r[T+2]/255,C=r[T+3]/255,r[T]=Math.max(0,Math.min(255*(x*o+P*n+v*s+C*c+l),255)),r[T+1]=Math.max(0,Math.min(255*(x*h+P*d+v*p+C*g+u),255)),r[T+2]=Math.max(0,Math.min(255*(x*m+P*E+v*_+C*I+f),255)),r[T+3]=Math.max(0,Math.min(255*(x*y+P*w+v*M+C*A+R),255));self.postMessage({id:e.data.id,message:t},[t.data.buffer])}},getImageSize=(e,t)=>{let a=new Image;a.onload=()=>{const e=a.naturalWidth,r=a.naturalHeight;a=null,t(e,r)},a.src=e},transforms={1:()=>[1,0,0,1,0,0],2:e=>[-1,0,0,1,e,0],3:(e,t)=>[-1,0,0,-1,e,t],4:(e,t)=>[1,0,0,-1,0,t],5:()=>[0,1,1,0,0,0],6:(e,t)=>[0,1,-1,0,t,0],7:(e,t)=>[0,-1,-1,0,t,e],8:e=>[0,-1,1,0,0,e]},fixImageOrientation=(e,t,a,r)=>{-1!==r&&e.transform.apply(e,transforms[r](t,a))},createPreviewImage=(e,t,a,r)=>{t=Math.round(t),a=Math.round(a);const i=document.createElement("canvas");i.width=t,i.height=a;const o=i.getContext("2d");return r>=5&&r<=8&&([t,a]=[a,t]),fixImageOrientation(o,t,a,r),o.drawImage(e,0,0,t,a),i},isBitmap=e=>/^image/.test(e.type)&&!/svg/.test(e.type),MAX_WIDTH=10,MAX_HEIGHT=10,calculateAverageColor=e=>{const t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),r=a.getContext("2d"),i=a.width=Math.ceil(e.width*t),o=a.height=Math.ceil(e.height*t);r.drawImage(e,0,0,i,o);let n=null;try{n=r.getImageData(0,0,i,o).data}catch(e){return null}const s=n.length;let c=0,l=0,h=0,d=0;for(;d<s;d+=4)c+=n[d]*n[d],l+=n[d+1]*n[d+1],h+=n[d+2]*n[d+2];return c=averageColor(c,s),l=averageColor(l,s),h=averageColor(h,s),{r:c,g:l,b:h}},averageColor=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),cloneCanvas=(e,t)=>{(t=t||document.createElement("canvas")).width=e.width,t.height=e.height;return t.getContext("2d").drawImage(e,0,0),t},cloneImageData=e=>{let t;try{t=new ImageData(e.width,e.height)}catch(a){t=document.createElement("canvas").getContext("2d").createImageData(e.width,e.height)}return t.data.set(new Uint8ClampedArray(e.data)),t},loadImage=e=>new Promise((t,a)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{t(r)},r.onerror=e=>{a(e)},r.src=e}),createImageWrapperView=e=>{const t=createImageOverlayView(e),a=createImageView(e),{createWorker:r}=e.utils,i=(e,t,a)=>new Promise(i=>{e.ref.imageData||(e.ref.imageData=a.getContext("2d").getImageData(0,0,a.width,a.height));const o=cloneImageData(e.ref.imageData);if(!t||20!==t.length)return a.getContext("2d").putImageData(o,0,0),i();const n=r(ColorMatrixWorker);n.post({imageData:o,colorMatrix:t},e=>{a.getContext("2d").putImageData(e,0,0),n.terminate(),i()},[o.data.buffer])}),o=({root:e,props:t,image:r})=>{const i=t.id,o=e.query("GET_ITEM",{id:i});if(!o)return;const n=o.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},s=e.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR");let c,l,h=!1;e.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(c=o.getMetadata("markup")||[],l=o.getMetadata("resize"),h=!0);const d=e.appendChildView(e.createChildView(a,{id:i,image:r,crop:n,resize:l,markup:c,dirty:h,background:s,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),e.childViews.length);e.ref.images.push(d),d.opacity=1,d.scaleX=1,d.scaleY=1,d.translateY=0,setTimeout(()=>{e.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:i})},250)},n=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},s=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return e.utils.createView({name:"image-preview-wrapper",create:({root:e})=>{e.ref.images=[],e.ref.imageData=null,e.ref.imageViewBin=[],e.ref.overlayShadow=e.appendChildView(e.createChildView(t,{opacity:0,status:"idle"})),e.ref.overlaySuccess=e.appendChildView(e.createChildView(t,{opacity:0,status:"success"})),e.ref.overlayError=e.appendChildView(e.createChildView(t,{opacity:0,status:"failure"}))},styles:["height"],apis:["height"],destroy:({root:e})=>{e.ref.images.forEach(e=>{e.image.width=1,e.image.height=1})},didWriteView:({root:e})=>{e.ref.images.forEach(e=>{e.dirty=!1})},write:e.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:({root:e})=>{const t=e.ref.images[e.ref.images.length-1];t.translateY=0,t.scaleX=1,t.scaleY=1,t.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:({root:e,props:t})=>{const{id:a}=t,r=e.query("GET_ITEM",a);if(!r)return;const i=URL.createObjectURL(r.file);getImageSize(i,(t,r)=>{e.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:a,width:t,height:r})})},DID_FINISH_CALCULATE_PREVIEWSIZE:({root:e,props:t})=>{const{id:a}=t,n=e.query("GET_ITEM",a);if(!n)return;const s=URL.createObjectURL(n.file),c=()=>{loadImage(s).then(l)},l=a=>{URL.revokeObjectURL(s);const r=(n.getMetadata("exif")||{}).orientation||-1;let{width:c,height:l}=a;if(!c||!l)return;r>=5&&r<=8&&([c,l]=[l,c]);const h=Math.max(1,.75*window.devicePixelRatio),d=e.query("GET_IMAGE_PREVIEW_ZOOM_FACTOR")*h,p=l/c,g=e.rect.element.width,u=e.rect.element.height;let m=g,E=m*p;p>1?(m=Math.min(c,g*d),E=m*p):(E=Math.min(l,u*d),m=E/p);const _=createPreviewImage(a,m,E,r),I=()=>{const r=e.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?calculateAverageColor(data):null;n.setMetadata("color",r,!0),"close"in a&&a.close(),e.ref.overlayShadow.opacity=1,o({root:e,props:t,image:_})},f=n.getMetadata("filter");f?i(e,f,_).then(I):I()};if((e=>{const t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./),a=t?parseInt(t[1]):null;return!(null!==a&&a<=58)&&"createImageBitmap"in window&&isBitmap(e)})(n.file)){const e=r(BitmapWorker);e.post({file:n.file},t=>{e.terminate(),t?l(t):c()})}else c()},DID_UPDATE_ITEM_METADATA:({root:e,props:t,action:a})=>{if(!/crop|filter|markup|resize/.test(a.change.key))return;if(!e.ref.images.length)return;const r=e.query("GET_ITEM",{id:t.id});if(r){if(/filter/.test(a.change.key)){const t=e.ref.images[e.ref.images.length-1];return void i(e,a.change.value,t.image)}if(/crop|markup|resize/.test(a.change.key)){const a=r.getMetadata("crop"),i=e.ref.images[e.ref.images.length-1];if(a&&a.aspectRatio&&i.crop&&i.crop.aspectRatio&&Math.abs(a.aspectRatio-i.crop.aspectRatio)>1e-5){const a=(({root:e})=>{const t=e.ref.images.shift();return t.opacity=0,t.translateY=-15,e.ref.imageViewBin.push(t),t})({root:e});o({root:e,props:t,image:cloneCanvas(a.image)})}else(({root:e,props:t})=>{const a=e.query("GET_ITEM",{id:t.id});if(!a)return;const r=e.ref.images[e.ref.images.length-1];r.crop=a.getMetadata("crop"),r.background=e.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR"),e.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(r.dirty=!0,r.resize=a.getMetadata("resize"),r.markup=a.getMetadata("markup"))})({root:e,props:t})}}},DID_THROW_ITEM_LOAD_ERROR:s,DID_THROW_ITEM_PROCESSING_ERROR:s,DID_THROW_ITEM_INVALID:s,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:n,DID_REVERT_ITEM_PROCESSING:n},({root:e})=>{const t=e.ref.imageViewBin.filter(e=>0===e.opacity);e.ref.imageViewBin=e.ref.imageViewBin.filter(e=>e.opacity>0),t.forEach(t=>((e,t)=>{e.removeChildView(t),t.image.width=1,t.image.height=1,t._destroy()})(e,t)),t.length=0})})},plugin=e=>{const{addFilter:t,utils:a}=e,{Type:r,createRoute:i,isFile:o}=a,n=createImageWrapperView(e);return t("CREATE_VIEW",e=>{const{is:t,view:a,query:r}=e;if(!t("file")||!r("GET_ALLOW_IMAGE_PREVIEW"))return;const s=({root:e})=>{e.ref.shouldRescale=!0};a.registerWriter(i({DID_RESIZE_ROOT:s,DID_STOP_RESIZE:s,DID_LOAD_ITEM:({root:e,props:t})=>{const{id:i}=t,s=r("GET_ITEM",i);if(!s||!o(s.file)||s.archived)return;const c=s.file;if(!isPreviewableImage(c))return;if(!r("GET_IMAGE_PREVIEW_FILTER_ITEM")(s))return;const l="createImageBitmap"in(window||{}),h=r("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!l&&h&&c.size>h)return;e.ref.imagePreview=a.appendChildView(a.createChildView(n,{id:i}));const d=e.query("GET_IMAGE_PREVIEW_HEIGHT");d&&e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s.id,height:d});const p=!l&&c.size>r("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");e.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:i},p)},DID_IMAGE_PREVIEW_CALCULATE_SIZE:({root:e,action:t})=>{e.ref.imageWidth=t.width,e.ref.imageHeight=t.height,e.ref.shouldRescale=!0,e.ref.shouldDrawPreview=!0,e.dispatch("KICK")},DID_UPDATE_ITEM_METADATA:({root:e,action:t})=>{"crop"===t.change.key&&(e.ref.shouldRescale=!0)}},({root:e,props:t})=>{e.ref.imagePreview&&(e.rect.element.hidden||(e.ref.shouldRescale&&(((e,t)=>{if(!e.ref.imagePreview)return;let{id:a}=t;const r=e.query("GET_ITEM",{id:a});if(!r)return;const i=e.query("GET_PANEL_ASPECT_RATIO"),o=e.query("GET_ITEM_PANEL_ASPECT_RATIO"),n=e.query("GET_IMAGE_PREVIEW_HEIGHT");if(i||o||n)return;let{imageWidth:s,imageHeight:c}=e.ref;if(!s||!c)return;const l=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),h=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),d=(r.getMetadata("exif")||{}).orientation||-1;if(d>=5&&d<=8&&([s,c]=[c,s]),!isBitmap(r.file)||e.query("GET_IMAGE_PREVIEW_UPSCALE")){const e=2048/s;s*=e,c*=e}const p=c/s,g=(r.getMetadata("crop")||{}).aspectRatio||p;let u=Math.max(l,Math.min(c,h));const m=e.rect.element.width,E=Math.min(m*g,u);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:r.id,height:E})})(e,t),e.ref.shouldRescale=!1),e.ref.shouldDrawPreview&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.dispatch("DID_FINISH_CALCULATE_PREVIEWSIZE",{id:t.id})})}),e.ref.shouldDrawPreview=!1)))}))}),{options:{allowImagePreview:[!0,r.BOOLEAN],imagePreviewFilterItem:[()=>!0,r.FUNCTION],imagePreviewHeight:[null,r.INT],imagePreviewMinHeight:[44,r.INT],imagePreviewMaxHeight:[256,r.INT],imagePreviewMaxFileSize:[null,r.INT],imagePreviewZoomFactor:[2,r.INT],imagePreviewUpscale:[!1,r.BOOLEAN],imagePreviewMaxInstantPreviewFileSize:[1e6,r.INT],imagePreviewTransparencyIndicator:[null,r.STRING],imagePreviewCalculateAverageImageColor:[!1,r.BOOLEAN],imagePreviewMarkupShow:[!0,r.BOOLEAN],imagePreviewMarkupFilter:[()=>!0,r.FUNCTION]}}},isBrowser="undefined"!=typeof window&&void 0!==window.document;isBrowser&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin}));export default plugin;